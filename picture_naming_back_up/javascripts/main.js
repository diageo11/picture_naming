// ITEM LIST //
var targets_1 = [
    [
        {
            'correct': ['rubber', 'left'],
            'stimulus': ['rubber', 'cannon'],
            'turn': 'partner'
        },
        {
            'correct': ['heart', 'left'],
            'stimulus': ['heart', 'car'],
            'turn': 'participant'
        },
        {
            'correct': ['windmill', 'left'],
            'stimulus': ['windmill', 'window'],
            'turn': 'partner'
        },
        {
            'correct': ['rubber', 'right'],
            'stimulus': ['kangaroo', 'rubber'],
            'turn': 'participant'
        }],
    [{
            'correct': ['coach', 'left'],
            'stimulus': ['bus', 'rabbit'],
            'turn': 'partner'
        },
        {
            'correct': ['pig', 'right'],
            'stimulus': ['raccoon', 'pig'],
            'turn': 'participant'
        },
        {
            'correct': ['cow', 'right'],
            'stimulus': ['chisel', 'cow'],
            'turn': 'partner'
        },
        {
            'correct': ['coach', 'left'],
            'stimulus': ['bus', 'comb'],
            'turn': 'participant'
        }],
 [{
            'correct': ['spectacles', 'left'],
            'stimulus': ['glasses', 'stool'],
            'turn': 'partner'
        },
        {
            'correct': ['ring', 'right'],
            'stimulus': ['ball', 'ring'],
            'turn': 'participant'
        },
        {
            'correct': ['spider', 'right'],
            'stimulus': ['ant', 'spider'],
            'turn': 'partner'
        },
        {
            'correct': ['spectacles', 'right'],
            'stimulus': ['vase', 'glasses'],
            'turn': 'participant'
        }],
 [{
            'correct': ['jacket', 'right'],
            'stimulus': ['shoe', 'jacket'],
            'turn': 'partner'
        },
        {
            'correct': ['lion', 'left'],
            'stimulus': ['lion', 'swan'],
            'turn': 'participant'
        },
        {
            'correct': ['boot', 'left'],
            'stimulus': ['boot', 'clock'],
            'turn': 'partner'
        },
        {
            'correct': ['jacket', 'left'],
            'stimulus': ['jacket', 'flag'],
            'turn': 'participant'
        }],
 [{
            'correct': ['gun', 'right'],
            'stimulus': ['sandwich', 'gun'],
            'turn': 'partner'
        },
        {
            'correct': ['toaster', 'left'],
            'stimulus': ['toaster', 'penguin'],
            'turn': 'participant'
        },
        {
            'correct': ['pliers', 'right'],
            'stimulus': ['scissors', 'pliers'],
            'turn': 'partner'
        },
        {
            'correct': ['gun', 'right'],
            'stimulus': ['pineapple', 'gun'],
            'turn': 'participant'
        }],
 [{
            'correct': ['hamper', 'right'],
            'stimulus': ['bell', 'basket'],
            'turn': 'partner'
        },
        {
            'correct': ['bell', 'right'],
            'stimulus': ['trousers', 'bell'],
            'turn': 'participant'
        },
        {
            'correct': ['flower', 'left'],
            'stimulus': ['flower', 'hat'],
            'turn': 'partner'
        },
        {
            'correct': ['hamper', 'left'],
            'stimulus': ['basket', 'iron'],
            'turn': 'participant'
        }],
 [{
            'correct': ['pitcher', 'left'],
            'stimulus': ['jug', 'thimble'],
            'turn': 'partner'
        },
        {
            'correct': ['cup', 'right'],
            'stimulus': ['tie', 'cup'],
            'turn': 'participant'
        },
        {
            'correct': ['celery', 'left'],
            'stimulus': ['celery', 'pipe'],
            'turn': 'partner'
        },
        {
            'correct': ['pitcher', 'left'],
            'stimulus': ['jug', 'sun'],
            'turn': 'participant'
        }],
 [{
            'correct': ['mushroom', 'left'],
            'stimulus': ['mushroom', 'butterfly'],
            'turn': 'partner'
        },
        {
            'correct': ['sheep', 'left'],
            'stimulus': ['sheep', 'goat'],
            'turn': 'participant'
        },
        {
            'correct': ['fox', 'left'],
            'stimulus': ['fox', 'tortoise'],
            'turn': 'partner'
        },
        {
            'correct': ['mushroom', 'right'],
            'stimulus': ['zebra', 'mushroom'],
            'turn': 'participant'
        }],
 [{
            'correct': ['toad', 'left'],
            'stimulus': ['frog', 'cigar'],
            'turn': 'partner'
        },
        {
            'correct': ['strawberry', 'right'],
            'stimulus': ['nose', 'strawberry'],
            'turn': 'participant'
        },
        {
            'correct': ['ashtray', 'right'],
            'stimulus': ['kite', 'ashtray'],
            'turn': 'partner'
        },
        {
            'correct': ['toad', 'right'],
            'stimulus': ['kite', 'frog'],
            'turn': 'participant'
        }],
 [{
            'correct': ['pearls', 'right'],
            'stimulus': ['plane', 'necklace'],
            'turn': 'partner'
        },
        {
            'correct': ['saw', 'left'],
            'stimulus': ['saw', 'bird'],
            'turn': 'participant'
        },
        {
            'correct': ['hammer', 'left'],
            'stimulus': ['hammer', 'helicopter'],
            'turn': 'partner'
        },
        {
            'correct': ['pearls', 'left'],
            'stimulus': ['necklace', 'anchor'],
            'turn': 'participant'
        }]];
var targets_2 = [
    [{
            'correct': ['eraser', 'left'],
            'stimulus': ['rubber', 'cannon'],
            'turn': 'partner'
        },
        {
            'correct': ['heart', 'left'],
            'stimulus': ['heart', 'car'],
            'turn': 'participant'
        },
        {
            'correct': ['windmill', 'left'],
            'stimulus': ['windmill', 'window'],
            'turn': 'partner'
        },
        {
            'correct': ['eraser', 'right'],
            'stimulus': ['kangaroo', 'rubber'],
            'turn': 'participant'
        }],
 [{
            'correct': ['bus', 'left'],
            'stimulus': ['bus', 'rabbit'],
            'turn': 'partner'
        },
        {
            'correct': ['pig', 'right'],
            'stimulus': ['raccoon', 'pig'],
            'turn': 'participant'
        },
        {
            'correct': ['cow', 'right'],
            'stimulus': ['chisel', 'cow'],
            'turn': 'partner'
        },
        {
            'correct': ['bus', 'left'],
            'stimulus': ['bus', 'comb'],
            'turn': 'participant'
        }],
 [{
            'correct': ['glasses', 'left'],
            'stimulus': ['glasses', 'stool'],
            'turn': 'partner'
        },
        {
            'correct': ['ring', 'right'],
            'stimulus': ['ball', 'ring'],
            'turn': 'participant'
        },
        {
            'correct': ['spider', 'right'],
            'stimulus': ['ant', 'spider'],
            'turn': 'partner'
        },
        {
            'correct': ['glasses', 'right'],
            'stimulus': ['vase', 'glasses'],
            'turn': 'participant'
        }],
 [{
            'correct': ['coat', 'right'],
            'stimulus': ['shoe', 'jacket'],
            'turn': 'partner'
        },
        {
            'correct': ['lion', 'left'],
            'stimulus': ['lion', 'swan'],
            'turn': 'participant'
        },
        {
            'correct': ['boot', 'left'],
            'stimulus': ['boot', 'clock'],
            'turn': 'partner'
        },
        {
            'correct': ['coat', 'left'],
            'stimulus': ['jacket', 'flag'],
            'turn': 'participant'
        }],
 [{
            'correct': ['pistol', 'right'],
            'stimulus': ['sandwich', 'gun'],
            'turn': 'partner'
        },
        {
            'correct': ['toaster', 'left'],
            'stimulus': ['toaster', 'penguin'],
            'turn': 'participant'
        },
        {
            'correct': ['pliers', 'right'],
            'stimulus': ['scissors', 'pliers'],
            'turn': 'partner'
        },
        {
            'correct': ['pistol', 'right'],
            'stimulus': ['pineapple', 'gun'],
            'turn': 'participant'
        }],
 [{
            'correct': ['basket', 'right'],
            'stimulus': ['bell', 'basket'],
            'turn': 'partner'
        },
        {
            'correct': ['bell', 'right'],
            'stimulus': ['trousers', 'bell'],
            'turn': 'participant'
        },
        {
            'correct': ['flower', 'left'],
            'stimulus': ['flower', 'hat'],
            'turn': 'partner'
        },
        {
            'correct': ['basket', 'left'],
            'stimulus': ['basket', 'iron'],
            'turn': 'participant'
        }],
 [{
            'correct': ['jug', 'left'],
            'stimulus': ['jug', 'thimble'],
            'turn': 'partner'
        },
        {
            'correct': ['cup', 'right'],
            'stimulus': ['tie', 'cup'],
            'turn': 'participant'
        },
        {
            'correct': ['celery', 'left'],
            'stimulus': ['celery', 'pipe'],
            'turn': 'partner'
        },
        {
            'correct': ['jug', 'left'],
            'stimulus': ['jug', 'sun'],
            'turn': 'participant'
        }],
 [{
            'correct': ['toadstool', 'left'],
            'stimulus': ['mushroom', 'butterfly'],
            'turn': 'partner'
        },
        {
            'correct': ['sheep', 'left'],
            'stimulus': ['sheep', 'goat'],
            'turn': 'participant'
        },
        {
            'correct': ['fox', 'left'],
            'stimulus': ['fox', 'tortoise'],
            'turn': 'partner'
        },
        {
            'correct': ['toadstool', 'right'],
            'stimulus': ['zebra', 'mushroom'],
            'turn': 'participant'
        }],
 [{
            'correct': ['frog', 'left'],
            'stimulus': ['frog', 'cigar'],
            'turn': 'partner'
        },
        {
            'correct': ['strawberry', 'right'],
            'stimulus': ['nose', 'strawberry'],
            'turn': 'participant'
        },
        {
            'correct': ['ashtray', 'right'],
            'stimulus': ['kite', 'ashtray'],
            'turn': 'partner'
        },
        {
            'correct': ['frog', 'right'],
            'stimulus': ['kite', 'frog'],
            'turn': 'participant'
        }],
 [{
            'correct': ['necklace', 'right'],
            'stimulus': ['plane', 'necklace'],
            'turn': 'partner'
        },
        {
            'correct': ['saw', 'left'],
            'stimulus': ['saw', 'bird'],
            'turn': 'participant'
        },
        {
            'correct': ['hammer', 'left'],
            'stimulus': ['hammer', 'helicopter'],
            'turn': 'partner'
        },
        {
            'correct': ['necklace', 'left'],
            'stimulus': ['necklace', 'anchor'],
            'turn': 'participant'
        }]];

var filler_targets = [
    {
        'correct': ['pencil', 'right'],
        'stimulus': ['ear', 'pencil'],
        'turn': 'participant'
    },
    {
        'correct': ['star', 'left'],
        'stimulus': ['star', 'grapes'],
        'turn': 'participant'
    },
    {
        'correct': ['bed', 'right'],
        'stimulus': ['bell', 'bed'],
        'turn': 'participant'
    },
    {
        'correct': ['ball', 'left'],
        'stimulus': ['ball', 'onion'],
        'turn': 'participant'
    },
    {
        'correct': ['hammer', 'left'],
        'stimulus': ['hammer', 'raccoon'],
        'turn': 'participant'
    },
    {
        'correct': ['kangaroo', 'left'],
        'stimulus': ['kangaroo', 'pencil'],
        'turn': 'participant'
    },
    {
        'correct': ['ruler', 'right'],
        'stimulus': ['piano', 'ruler'],
        'turn': 'participant'
    },
    {
        'correct': ['star', 'right'],
        'stimulus': ['heart', 'star'],
        'turn': 'participant'
    },
    {
        'correct': ['snail', 'left'],
        'stimulus': ['snail', 'nail'],
        'turn': 'participant'
    },
    {
        'correct': ['screwdriver', 'left'],
        'stimulus': ['screwdriver', 'bell'],
        'turn': 'participant'
    },
    {
        'correct': ['banana', 'right'],
        'stimulus': ['harp', 'banana'],
        'turn': 'participant'
    },
    {
        'correct': ['zebra', 'left'],
        'stimulus': ['zebra', 'horse'],
        'turn': 'participant'
    },
    {
        'correct': ['fish', 'right'],
        'stimulus': ['finger', 'fish'],
        'turn': 'participant'
    },
    {
        'correct': ['monkey', 'left'],
        'stimulus': ['monkey', 'snake'],
        'turn': 'participant'
    },
    {
        'correct': ['cigar', 'left'],
        'stimulus': ['cigar', 'chisel'],
        'turn': 'participant'
    },
    {
        'correct': ['shirt', 'right'],
        'stimulus': ['hat', 'shirt'],
        'turn': 'participant'
    },
    {
        'correct': ['trumpet', 'left'],
        'stimulus': ['trumpet', 'balloon'],
        'turn': 'participant'
    },
    {
        'correct': ['ring', 'right'],
        'stimulus': ['pear', 'ring'],
        'turn': 'participant'
    },
    {
        'correct': ['lion', 'left'],
        'stimulus': ['lion', 'iron'],
        'turn': 'participant'
    },
    {
        'correct': ['rabbit', 'right'],
        'stimulus': ['lion', 'rabbit'],
        'turn': 'participant'
    },
    {
        'correct': ['tree', 'left'],
        'stimulus': ['tree', 'caterpillar'],
        'turn': 'participant'
    },
    {
        'correct': ['carrot', 'right'],
        'stimulus': ['caterpillar', 'carrot'],
        'turn': 'participant'
    },
    {
        'correct': ['windmill', 'left'],
        'stimulus': ['windmill', 'watch'],
        'turn': 'participant'
    },
    {
        'correct': ['cup', 'right'],
        'stimulus': ['shoe', 'cup'],
        'turn': 'participant'
    },
    {
        'correct': ['cigarette', 'right'],
        'stimulus': ['celery', 'cigarette'],
        'turn': 'participant'
    },
    {
        'correct': ['cow', 'right'],
        'stimulus': ['crown', 'cow'],
        'turn': 'participant'
    },
    {
        'correct': ['elephant', 'right'],
        'stimulus': ['mouse', 'elephant'],
        'turn': 'participant'
    },
    {
        'correct': ['balloon', 'left'],
        'stimulus': ['balloon', 'snowman'],
        'turn': 'participant'
    },
    {
        'correct': ['table', 'right'],
        'stimulus': ['cup', 'table'],
        'turn': 'participant'
    },
    {
        'correct': ['trumpet', 'right'],
        'stimulus': ['toothbrush', 'trumpet'],
        'turn': 'participant'
    },
    {
        'correct': ['screwdriver', 'right'],
        'stimulus': ['screw', 'screwdriver'],
        'turn': 'participant'
    },
    {
        'correct': ['pipe', 'left'],
        'stimulus': ['pipe', 'knife'],
        'turn': 'participant'
    },
    {
        'correct': ['plane', 'left'],
        'stimulus': ['plane', 'anchor'],
        'turn': 'participant'
    }];
var filler_comps = [
    {
        'correct': ['crown', 'right'],
        'stimulus': ['desk', 'crown'],
        'turn': 'partner'
    },
    {
        'correct': ['ear', 'left'],
        'stimulus': ['ear', 'heart'],
        'turn': 'partner'
    },
    {
        'correct': ['orange', 'left'],
        'stimulus': ['orange', 'onion'],
        'turn': 'partner'
    },
    {
        'correct': ['toaster', 'right'],
        'stimulus': ['table', 'toaster'],
        'turn': 'partner'
    },
    {
        'correct': ['balloon', 'left'],
        'stimulus': ['balloon', 'fork'],
        'turn': 'partner'
    },
    {
        'correct': ['skunk', 'right'],
        'stimulus': ['ruler', 'skunk'],
        'turn': 'partner'
    },
    {
        'correct': ['book', 'right'],
        'stimulus': ['duck', 'book'],
        'turn': 'partner'
    },
    {
        'correct': ['desk', 'left'],
        'stimulus': ['desk', 'button'],
        'turn': 'partner'
    },
    {
        'correct': ['spoon', 'right'],
        'stimulus': ['hammer', 'spoon'],
        'turn': 'partner'
    },
    {
        'correct': ['comb', 'left'],
        'stimulus': ['comb', 'ruler'],
        'turn': 'partner'
    },
    {
        'correct': ['bed', 'right'],
        'stimulus': ['piano', 'bed'],
        'turn': 'partner'
    },
    {
        'correct': ['helicopter', 'left'],
        'stimulus': ['helicopter', 'kite'],
        'turn': 'partner'
    },
    {
        'correct': ['violin', 'left'],
        'stimulus': ['violin', 'guitar'],
        'turn': 'partner'
    },
    {
        'correct': ['waistcoat', 'left'],
        'stimulus': ['waistcoat', 'trousers'],
        'turn': 'partner'
    },
    {
        'correct': ['pineapple', 'right'],
        'stimulus': ['strawberry', 'pineapple'],
        'turn': 'partner'
    },
    {
        'correct': ['dog', 'left'],
        'stimulus': ['dog', 'cat'],
        'turn': 'partner'
    },
    {
        'correct': ['giraffe', 'left'],
        'stimulus': ['giraffe', 'whistle'],
        'turn': 'partner'
    },
    {
        'correct': ['harp', 'right'],
        'stimulus': ['hand', 'harp'],
        'turn': 'partner'
    },
    {
        'correct': ['waistcoat', 'right'],
        'stimulus': ['umbrella', 'waistcoat'],
        'turn': 'partner'
    },
    {
        'correct': ['cake', 'left'],
        'stimulus': ['cake', 'camel'],
        'turn': 'partner'
    },
    {
        'correct': ['camel', 'left'],
        'stimulus': ['camel', 'candle'],
        'turn': 'partner'
    },
    {
        'correct': ['watch', 'right'],
        'stimulus': ['belt', 'watch'],
        'turn': 'partner'
    },
    {
        'correct': ['table', 'right'],
        'stimulus': ['sock', 'table'],
        'turn': 'partner'
    },
    {
        'correct': ['bottle', 'right'],
        'stimulus': ['boot', 'bottle'],
        'turn': 'partner'
    },
    {
        'correct': ['tie', 'left'],
        'stimulus': ['tie', 'glove'],
        'turn': 'partner'
    },
    {
        'correct': ['carrot', 'left'],
        'stimulus': ['carrot', 'onion'],
        'turn': 'partner'
    },
    {
        'correct': ['thumb', 'right'],
        'stimulus': ['thimble', 'thumb'],
        'turn': 'partner'
    },
    {
        'correct': ['crown', 'left'],
        'stimulus': ['crown', 'clown'],
        'turn': 'partner'
    },
    {
        'correct': ['book', 'left'],
        'stimulus': ['book', 'candle'],
        'turn': 'partner'
    },
    {
        'correct': ['tiger', 'right'],
        'stimulus': ['pumpkin', 'tiger'],
        'turn': 'partner'
    },
    {
        'correct': ['comb', 'left'],
        'stimulus': ['comb', 'ladder'],
        'turn': 'partner'
    },
    {
        'correct': ['horse', 'left'],
        'stimulus': ['horse', 'giraffe'],
        'turn': 'partner'
    },
    {
        'correct': ['spider', 'left'],
        'stimulus': ['spider', 'fly'],
        'turn': 'partner'
    }];

// generate a random subject ID with 15 characters
var subject_id = jsPsych.randomization.randomID(15);

// TEXT DATA
var partner = 'computer';
var consent_form = `<div class='instructions'><h1>Consent Form</h1>
  <p>Exploring the relationship between language and cognitive load in human-computer dialogue</p>
  <p class='strong'>Fair Processing Statement</p>
  <p>This information is being collected as part of a research project concerned with the relationship between language and cognitive load in speech-based human-computer interaction. All data provided by you today will be de-identified and will only be accessed by authorized personell. Information will be retained by the University College Dublin and will only be accessed for research and auditing purposes. At no point will your data be shared with any commercial 3rd parties.</p>
  <p class='strong'>Statements of Consent</p>
  <p><input type='checkbox' class='consent'> I confirm that I have read and understand the participant information sheet for this study.</p>
  <p><input type='checkbox' class='consent'> I understand that my participation is voluntary and that I am free to withdraw at any time without giving any reason. If I withdraw during the experiment, the data will be deleted and removed from the study.</p>
  <p><input type='checkbox' class='consent'> I understand that my personal data will be processed for the purposes detailed above in accordance with GDPR and the Data Protection Act (1998).</p>
  <p class='strong'>By clicking 'agree' I provide my full consent to participate.</p></div>`;

var instructions = [
    `<p>In this game you will take turns matching and naming objects presented on screen.</p>

    <p>Your partner in this game is a ${partner} based in a remote location.</p>

    <p class='strong'>Press ENTER to continue</p>`
    ,
    `<p>When acting as a <span class='strong'>matcher</span> you must listen for the object named by your partner and press:</p>

    <p>'left arrow key' for the image on your left, <br>
    OR <br> 'right arrow key' for the image on your right.</p>

    <p class='strong'>Press ENTER to continue</p>`
    ,
    `<p>When acting as a <span class='strong'>namer</span> two images will be presented.
	<br>You must name the image highlighted by a red box.</p>

    <p>After naming the image press <span class='strong'>SPACE</span> to continue.</p>
    <p>You will take turns naming and matching the images displayed on screen.</p>
    <p class='strong'>Press ENTER to continue</p>`
    ,
    `<p>First a quick practice run.</p>
    <p>Please try to be as quick and accurate as possible.</p>
    <p class='strong'>Press ENTER to begin the practice run</p>`
];

var demo_form = `<div class='instructions'>
    <h1>Demographics Questionnaire</h1>
    <div class='form'>
        <label for='age'>Age: </label>
        <input type='number' id='age' name='age' min='18' max='100' required>
    </div>
    <div class='form'>
        <label for='gender'>Gender: </label>
        <select id='gender' name='gender_drop' required>
            <option disabled selected value> -- select an option -- </option>
            <option>Prefer not to say</option>
            <option>Male</option>
            <option>Female</option>
            <option>Non-binary</option>
        </select>
    </div>
    <div class='form'>
        <label for='education'>What is the highest level of education completed? </label>
        <select id='education' name='education_drop' required>
            <option disabled selected value> -- select an option -- </option>
            <option>Prefer not to say</option>
            <option>Secondary or High School</option>
            <option>Vocational Qualification</option>
            <option>Bachelor's Degree</option>
            <option>Master's or Higher</option>
        </select>
    </div>
    <div class='form'>
        <label for='speech'>How often do you use speech interface systems like Alexa, Siri, or Google Assistant? </label>
        <select id='speech' name='speech_drop' required>
            <option disabled selected value> -- select an option -- </option>
            <option>Daily</option>
            <option>A few times per week</option>
            <option>A few times per month</option>
            <option>Rarely</option>
            <option>Never</option>
            <options>Used a lot at first but now it's rarely used</option>
        </select>
    </div>
    <div class='form optionals hidden'>
        <label for='assistant'>Which of the following do you use most often: </label>
        <select id='assistant' name='assistant_drop'>
            <option disabled selected value> -- select an option -- </option>
            <option>Amazon Alexa</option>
            <option>Apple's Siri</option>
            <option>Google Assistant</option>
            <option>Cortana</option>
            <option>Other</option>
        </select>
    </div>
    <div class='form hidden' id='ass_holder'>
        <label for='other_ass'>Other assistant used: </label>
        <input type='text' id='other_ass' name='other_assistant' autocomplete="off">
    </div>
    <div class='form optionals hidden'>
        <label for='device'>Which device do you use most frequently to access these systems? </label>
        <select id='device' name='device_drop'>
            <option disabled selected value> -- select an option -- </option>
            <option>Smartphone</option>
            <option>Smart speaker</option>
            <option>In car</option>
            <option>Other</option>
        </select>
    </div>
    <div class='form hidden' id='dev_holder'>
        <label for='other_dev'>Other device used: </label>
        <input type='text' id='other_dev' name='other_device' autocomplete="off">
    </div>
    <div class='form'>
        <label for='native'>Are you a native English speaker? </label>
        <select id='native' name='native_speaker' required>
            <option disabled selected value> -- select an option -- </option>
            <option>Yes</option>
            <option>No</option>
        </select>
    </div>
    <div class='form hidden' id='english_holder'>
        <label for='device'>How would you rate your spoken English proficiency out of 5? </label>
        <select id='nonnative' name='nonnative_speaker'>
            <option disabled selected value> -- select an option -- </option>
            <option>5 - Near native</option>
            <option>4 - Advanced</option>
            <option>3 - Proficient</option>
            <option>2 - Beginner</option>
            <option>1 - I cannot speak English</option>
        </select>
    </div>
    <div class='form'>
        <label for='vision'>Do you have normal to corrected vision? </label>
        <select id='vision' name='normal_vision' required>
            <option disabled selected value> -- select an option -- </option>
            <option>Yes</option>
            <option>No</option>
        </select>
    </div>
    <div class='form'>
        <label for='hearing'>Do you have normal to corrected hearing? </label>
        <select id='hearing' name='normal_hearing' required>
            <option disabled selected value> -- select an option -- </option>
            <option>Yes</option>
            <option>No</option>
        </select>
    </div>
    <div class='form'>
        <label for='impairment'>Do you suffer from a diagnosed speech or cognitive impairment? </label>
        <select id='impairment' name='impairment_condition' required>
            <option disabled selected value> -- select an option -- </option>
            <option>Yes</option>
            <option>No</option>
        </select>
    </div>
</div>
`;

var nasa_form = `
<div class='instructions'>
	<p>Thinking about the experiences you just had with the system, please complete the following questionnaire:
    <div class='questionnaire'><label for='mental'>How mentally demanding were the tasks? </label></div> 
	<div class='questionnaire'>low <input type='range' id='mental' name='mental' min='0' max='20' required> high</div>
    <div class='questionnaire'><label for='physical'>How physically demanding were the tasks? </label></div> 
	<div class='questionnaire'>low <input type='range' id='physical' name='physical' min='0' max='20' required> high</div>
    <div class='questionnaire'><label for='temporal'>How hurried or rushed was the pace of the tasks? </label></div> 
	<div class='questionnaire'>low <input type='range' id='temporal' name='temporal' min='0' max='20' required> high</div>
    <div class='questionnaire'><label for='performance'>How successful were you in accomplishing the tasks? </label></div> 
	<div class='questionnaire'>good <input type='range' id='performance' name='performance' min='0' max='20' required> poor</div>
    <div class='questionnaire'><label for='effort'>How hard did you have to work to accomplish your level of performance? </label></div> 
	<div class='questionnaire'>low <input type='range' id='effort' name='effort' min='0' max='20' required> high</div>
    <div class='questionnaire'><label for='frustration'>How insecure, discouraged, irritated, stressed, or annoyed were you? </label></div> 
	<div class='questionnaire'>low <input type='range' id='frustration' name='frustration' min='0' max='20' required> high</div>
</div>`;


// pick a random condition for the subject at the start of the experiment
var condition_assignment = jsPsych.randomization.sampleWithoutReplacement(['condA', 'condB'], 1)[0];

var debrief_text = `<div class='instructions'>
    <p> Thank you for your participation. The aim of this study is to gain an understanding of how people’s word choices change when they are asked to do another task at the same time. In this study we are particularly looking at a phenomenon whereby people tend to copy the words their partners say to describe things (termed alignment), and whether doing another task whilst naming objects (e.g. a number categorisation task) affects how much people do this.</p>
	<p>If you had to do the number categorisation task when naming the objects, you were in the Numbers Task condition (Condition B). If you didn’t have to categorise numbers, you were in the control condition (Condition A). You were in condition ${condition_assignment.slice(-1)}.</p>
    <p>Please enter your completion code in MTurk to confirm your participation. Your unique completion code is:</p>
    <p class='larger'>${subject_id}</p>
    <p>You are reminded that all the data has been de-identified. Should you wish to access data relevant to your participation you will be required to use the unique completion code provided.</p>
    <p> If you require any information regarding this study, or your participation in it, please contact:</p>
    <p>Dr Benjamin Cowan or Philip Dyle at <a href='mailto: ucdicsresearch@gmail.com'>ucd.ics.research@gmail.com</a></p>
    <p>Thank you once again, the time and effort you have taken to participate in this study is greatly appreciated.</p>
</div>`

//_______________________________________//


// Start experiment function
function startExperiment() {
    /* start the experiment */
    jsPsych.init({
        timeline: timeline,
        preload_images: images,
        preload_audio: audio,
        exclusions: {
            min_width: 800,
            min_height: 600,
            audio: true
        },
        on_finish: function () {
            jsPsych.data.displayData('json');
        },
        show_progress_bar: false,
        on_close: function () {


            if (!experiment_completed) {
                console.log('removing participant', subject_id);
                markAbandoned(subject_id);
                setTimeout(function () {
                    setTimeout(function () {
                        console.log('cancelled');

                        let data = `${subject_id},pending,${Date.now()},${condition_assignment},${list_assignment}\n`;

                        appendToChangelog(data);
                    }, 1000);
                    console.log('alerted about leaving');

                }, 1);
            }
        }
    });
}

// Save completion code to IndexDB
function saveInfo(name, data) {
    try {
        localStorage.setItem(name, data);
    } catch (e) {
        if (e == QUOTA_EXCEEDED_ERR) {
            alert('Storage limit exceeded');
        }
    }
}

function saveData(name, data) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.send(JSON.stringify({
        filename: name,
        filedata: data
    }));
}

function showAlert() {
    html = `<div class = 'alert_holder'><div class = 'answer_display'>
  		<h1>Experiment Interrupted</h1>
  		<p>We noticed that you left the experiment screen during the experiment.
  		Please refrain from doing so until the experiment is completed.
  		We thank you for your cooperation.</p>
  		<button id='alert_btn' onclick = 'contExp()' >I understand</button>
  	</div></div>`
    $('body').append($(html));
    console.log('blurred');
}

function contExp() {
    jsPsych.resumeExperiment();
    $('.alert_holder').remove();
}

// Change demos questionnnaire depending on answers
function demoCheck() {
    // Add extra questions based on use of assistants
    $('#speech').change(function () {
        if (this.value != 'Never') {
            $('.optionals').removeClass('hidden');
        } else {
            $('.optionals').addClass('hidden');
        }
    });

    // Add textbox for 'other'
    $('#assistant').change(function () {
        if (this.value == 'Other') {
            $('#ass_holder').removeClass('hidden');
        } else {
            $('#ass_holder').addClass('hidden');
        }
    });

    $('#device').change(function () {
        if (this.value == 'Other') {
            $('#dev_holder').removeClass('hidden');
        } else {
            $('#dev_holder').addClass('hidden');
        }
    });

    $('#native').change(function () {
        if (this.value == 'No') {
            $('#english_holder').removeClass('hidden');
        } else {
            $('#english_holder').addClass('hidden');
        }
    });
}

// Get number stroops
function getNumberStroop() {
    // Create holder
    var html = `<div class='number-stroop'>`;
    // Initialise variables
    var class_1 = `class='larger'`;
    var class_2 = '';
    // Choose random number for each side of screen
    var no_1 = Math.round(Math.random() * 9);
    var no_2 = Math.round(Math.random() * 9);
    // Make sure they're not the same number
    while (no_1 == no_2) {
        no_2 = Math.round(Math.random() * 10);
    }
    // Check larger value
    var value = 1;
    if (no_1 < no_2) {
        value = 2;
    }

    // Choose larger size
    var size = 1;
    if (Math.random() <= .5) {
        size = 2;
        [class_1, class_2] = [class_2, class_1];
    }

    html += `<p ${class_1}>${no_1}</p><p ${class_2}>${no_2}</p>`;

    html += `</div>`;

    // Save stroop data
    var data = {
        html: html,
        no_1: no_1,
        no_2: no_2,
        value: value,
        size: size
    }
    return data;
}

// pick random list assignment
var list_assignment = jsPsych.randomization.sampleWithoutReplacement(['listA', 'listB'], 1)[0];

// Holds both lists to reference later
var list_holder = {
    'listA': targets_1,
    'listB': targets_2
}

// Create a randomised version
var shuffled = jsPsych.randomization.shuffle(list_holder[list_assignment]);
var exp_list = [];

var practice_comps = jsPsych.randomization.sampleWithoutReplacement(filler_comps, 5);
var practice_targets = jsPsych.randomization.sampleWithoutReplacement(filler_targets, 5);
var practice_variables = [];

for (let i = 0; i < 5; i++) {
    practice_variables.push({
        'comp': practice_comps[i],
        'target': practice_targets[i]
    });
}
console.log(practice_variables);


// Randomise fillers
filler_comps = jsPsych.randomization.shuffle(filler_comps);
filler_targets = jsPsych.randomization.shuffle(filler_targets);


// Add three fillers to start with
for (let i = 0; i < 3; i++) {
    exp_list.push({
        comp: filler_comps.shift(),
        target: filler_targets.shift()
    });
}

// Create holders for all images and audio being used for pre-buffering
var images = [];
var audio = [];

// Add each target item to the main experiment list
shuffled.forEach(function (group) {

    // Add three fillers before every target item
    for (let i = 0; i < 3; i++) {
        let j = {
            comp: filler_comps.shift(),
            target: filler_targets.shift()
        };
        exp_list.push(j);

        // Save to audio for preloading
        audio.push(`audio/${j['comp'].correct[0]}.mp3`);

        $.each(j, (k, v) => {
            v.stimulus.forEach(item => images.push(`images/${item}.bmp`));
        });

    }

    // Unpack group of four items
    let x = 0;
    while (x < 2) {
        let y = x * 2;
        let j = {
            comp: group[y],
            target: group[y + 1]
        };

        exp_list.push(j);
        x++;

        // Save to audio for preloading
        audio.push(`audio/${j['comp'].correct[0]}.mp3`);

        $.each(j, (k, v) => {
            v.stimulus.forEach(item => images.push(`images/${item}.bmp`));
        });

    }

});

// Convert to sets to remove duplicates
audio = [...new Set(audio)];
images = [...new Set(images)];

var prevent_leave = true;
var experiment_completed = false;

window.onbeforeunload = function (e) {
    e = e || window.event;

    if (prevent_leave) {
        // Cancel the event
        e.preventDefault();
        e.returnValue = 'Your progress will not be saved if you leave the site. Are you sure you want to continue?';
    } else {
        delete e['returnValue'];
    }

};

var consent = {
    type: 'html-button-response',
    stimulus: consent_form,
    choices: ['agree'],
    on_load: function () {
        // Disable button
        $('.jspsych-btn').prop('disabled', true);

        // Check if tickboxes are changed
        $(".consent").change(function () {
            // Check if all boxes checked
            if ($('.consent:checked').length == $('.consent').length) {
                console.log('all checked');
                // Enable button
                $('.jspsych-btn').prop('disabled', false);
            } else {
                // Disable button if not all checked
                $('.jspsych-btn').prop('disabled', true);
            }
        });

        $(window).blur(function () {
            showAlert();
            jsPsych.pauseExperiment();
        });

        jsPsych.data.addProperties({
            audioLabel: audioTrackLabel
        });
    },
    on_finish: function (data) {
        getChangelog().then(console.log('conditions activated'));
    }
};

var intro = {
    type: 'instructions',
    pages: instructions,
    key_forward: 'enter'
}

var practice_task = {
    type: 'picture-match',
    subject: subject_id,
    timeline: [
        {
            info: jsPsych.timelineVariable('comp'),
            post_trial_gap: 1500
        },
        {
            info: jsPsych.timelineVariable('target'),
            post_trial_gap: 2500
        }
    ],
    timeline_variables: practice_variables,
    loop_function: data => {
        if (data.filter({
                correct: true
            }).count() < (practice_variables.length - 1)) {
            alert(`You got less than ${(practice_variables.length -1)} correct answers, please try again.`);
            return true
        }
        return false
    }
}

var stroop_instructions = {
    timeline: [{
        type: 'instructions',
        key_forward: 'enter',
        pages: [` <p>Between naming and matching turns you will also complete a memory task.</p>
              <p>For this task two numbers will be presented on screen.</p>
              <div class='number-stroop'><p class='larger'>4</p><p>8</p></div>
              <p class='strong'>Press ENTER to continue</p>`,
          `   <p>Two turns later you will be asked which number has a larger numeric value [<span class='strong'>VALUE</span>]...</p>
              <p>... or which one has a larger physical size [<span class='strong'>SIZE</span>]</p>
              <div class='number-stroop'><p class='larger'>4</p><p>8</p></div>
              <p class='strong'>Press ENTER to continue</p>`,
          `   <p>So in this example if you see the word <span class='strong'>VALUE</span>,<br> hit the right arrow key to choose 8.</p>
              <p>But if you see the word <span class='strong'>SIZE</span>,<br>hit the left arrow key to choose 4.</p>
              <div class='number-stroop'><p class='larger'>4</p><p>8</p></div>
              <p class='strong'>Press ENTER to continue</p>`,
          `   <p>First, a practice run.</p>
              <p>You must get 3 out of 5 correct during the practice to continue.</p>
              <p>Try to be as quick as possible as you have less than 2 seconds to answer.</p>
              <p class='strong'>Press ENTER to continue</p>`
           ]
	}],
    conditional_function: function () {
        if (condition_assignment == 'condB') {
            return true
        } else {
            return false
        } // should be false
    }
}

var number_stroop = {
    type: 'html-keyboard-response',
    choices: jsPsych.NO_KEYS,
    post_trial_gap: 100,
    timeline: [
        {
            stimulus: `WATCH OUT FOR NUMBERS`,
            trial_duration: 500
        },
        {
            stimulus: '',
            on_start: function (trial) {
                data = getNumberStroop();
                trial.data = data;
                trial.data.filter = 'numbers';

                trial.stimulus = data.html
            },
            trial_duration: 500
        }
    ],
    conditional_function: function () {
        if (condition_assignment == 'condB') {
            return true
        } else {
            return false
        } // should be false

    }
}

var check_stroop = {
    type: 'html-keyboard-response',
    choices: jsPsych.NO_KEYS,
    post_trial_gap: 100,
    timeline: [
        {
            stimulus: function () {
                var choice = jsPsych.randomization
                    .sampleWithoutReplacement(['VALUE', 'SIZE'], 1)[0];

                return `<p class='larger'>${choice}</p>`
            },
            choices: ['leftarrow', 'rightarrow'],
            trial_duration: 2000
        },
        {
            stimulus: '',
            data: {
                correct: null
            },
            on_start: trial => {
                var data = jsPsych.data.get().last().values()[0];
                var answer = jsPsych.data.get().filter({
                    filter: 'numbers'
                }).last().values()[0];

                var check = '';
                if (data.stimulus.includes('VALUE')) {
                    check = answer.value;
                } else if (data.stimulus.includes('SIZE')) {
                    check = answer.size;
                } else {
                    alert('stroop issue');
                }

                var stim = 'INCORRECT';
                if (data.key_press) {
                    if (((data.key_press == 37) && (check == 1)) ||
                        ((data.key_press == 39) && (check == 2))) {
                        stim = 'CORRECT';
                        trial.data.correct = true;
                    } else {
                        trial.data.correct = false;
                    }

                } else {
                    stim = 'TIMEOUT';
                }

                trial.stimulus = `<p class='larger'>${stim}</p>`;
            },
            trial_duration: function () {
                var rt = jsPsych.data.get().last().values()[0].rt;

                return 1000 + (2000 - rt)
            },
            post_trial_gap: 500
        }
    ],
    conditional_function: function () {
        if (condition_assignment == 'condB') {
            return true
        } else {
            return false
        } // should be false

    }
}

var stroop_practice = {
    timeline: [
        number_stroop, check_stroop
    ],
    repetitions: 5,
    loop_function: data => {
        console.log(data.values());
        if (condition_assignment == 'condB') {
            if (data.filter({
                    correct: true
                }).count() < 3) {
                alert(`You got less than 3 correct answers, please try again. Remember to choose the highest valued number for VALUE, and the bold number for SIZE.
						     Press the right or left arrows to choose.`);
                return true
            }
        }

        return false
    }
}




var begin_game = {
    type: 'html-keyboard-response',
    choices: ['enter'],
    stimulus: ` <p>You will now begin the main game.                    </p>
                    <p>Please try to be as quick and accurate as possible.  </p>
                    <p class='strong'>Press Enter to begin the game.        </p>`
}

var demos = {
    type: 'survey-html-form',
    html: demo_form,
    on_load: function () {
        demoCheck();
    }
}

var nasa = {
    type: 'survey-html-form',
    html: nasa_form
}

var reject_part = {
    timeline: [{
        type: 'html-keyboard-response',
        choices: jsPsych.NO_KEYS,
        stimulus: `Unfortunately you have not met the minimum requirments for this experiment and are not eligible to participate.`
    }],
    conditional_function: function () {
        var data = jsPsych.data.get().filter({
            trial_type: 'survey-html-form'
        }).values()[0].responses;
        data = JSON.parse(data);

        if ((data.impairment_condition == 'Yes') || (data.normal_hearing == 'No') || (data.normal_vision == 'No') || ((data.native_speaker == 'No') && (parseInt(data.nonnative_speaker[0]) < 4))) {
            return true
        } else {
            return false
        }

    }
}


var main = {
    timeline: [
        {
            type: 'picture-match',
            info: jsPsych.timelineVariable('comp'),
            subject: subject_id,
            post_trial_gap: function () {
                if (condition_assignment == 'condB') {
                    return 500
                } else {
                    return 1500
                }
            }
        },
        number_stroop,
        {
            type: 'picture-match',
            info: jsPsych.timelineVariable('target'),
            subject: subject_id,
            post_trial_gap: function () {
                if (condition_assignment == 'condB') {
                    return 500
                } else {
                    return 3000
                }
            }
        },
        check_stroop
    ],
    timeline_variables: exp_list
}

var debrief = {
    type: 'html-keyboard-response',
    stimulus: debrief_text,
    choices: jsPsych.NO_KEYS,
    on_load: function () {
        prevent_leave = false;
        saveInfo('completion_code_PMT', subject_id);
        experiment_completed = true;
        markCompleted(subject_id);

        var results = jsPsych.data.get();
        var interaction = jsPsych.data.getInteractionData();
        var data = results.join(interaction);
        saveData(subject_id, data.csv());
    }
}

var enter_full = {
    type: 'fullscreen',
    fullscreen_mode: true
};

// ALLOWS CHOICE OF CONDITION - MUST CHANGE FOR REAL EXPERIMENT (INCLUDING ADD PROPERTIES AT START OF SCRIPT)
var testing = {
    type: 'html-keyboard-response',
    choices: ['a', 'b'],
    stimulus: `Press key to select condition:
                <br> [a] - no stroop <br> [b] - number stroop
                <br><br><br>TESTING SCREEN - NOT INCLUDED IN EXPERIMENT`,
    on_finish: data => {
        if ('a' == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press)) {
            condition_assignment = 'condA';
            console.log('condition assignment changed to: A');
        } else {
            console.log('condition assignment changed to: B');
            condition_assignment = 'condB';
        }

        jsPsych.data.addProperties({
            condition: condition_assignment
        });

    }

}

// Check if experiment already completed
if (localStorage.getItem('completion_code_PMT')) {
    var completion_code = localStorage.getItem('completion_code_PMT');
    alert("You have already completed this experiment. Your completion code is: " + completion_code);
}

var timeline = [enter_full, consent, intro, practice_task, stroop_instructions, stroop_practice, demos, reject_part, begin_game, main, nasa, debrief];


//startExperiment(); //Delete this to include microphone check
